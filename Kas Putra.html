<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kas Putra — Assalam</title>
  <style>
    :root {
      --bg: #0f0f0f;
      --card: #1a1a1a;
      --text: #ffffff;
      --muted: #9ca3af;
      --accent: #3b82f6;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      margin: 0;
      background: linear-gradient(180deg, #0d0d0d, #1b1b1b);
      color: var(--text);
    }

    header {
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 22px;
      color: var(--text);
    }

    p {
      margin-top: 5px;
      color: var(--muted);
    }

    .container {
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 16px;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
      padding: 20px;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--text);
      margin-top: 12px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #2d2d2d;
      text-align: center;
      font-size: 14px;
    }

    th {
      background: #111;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    input[type="checkbox"] {
      transform: scale(1.2);
      accent-color: var(--accent);
      cursor: pointer;
    }

    .right { text-align: right; }

    .hidden { display: none; }

    button {
      background: #111;
      border: 1px solid #333;
      color: var(--text);
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: var(--accent);
      color: white;
    }

    footer {
      text-align: center;
      color: var(--muted);
      padding: 20px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Kas Putra — Catatan Kas Bendahara</h1>
    <p>Publik dapat melihat, hanya admin yang bisa mengedit</p>
  </header>

  <main class="container">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <strong>Daftar Pembayaran Santri (Oktober - 12 Bulan)</strong>
        <div>
          <button id="adminBtn">Masuk Admin</button>
          <button id="logoutBtn" class="hidden">Keluar Admin</button>
        </div>
      </div>

      <div style="overflow:auto;margin-top:16px;">
        <table id="childrenTable">
          <thead>
            <tr id="monthHeader">
              <th>Nama</th>
              <!-- bulan diisi lewat JS -->
              <th>Total (Rp)</th>
            </tr>
          </thead>
          <tbody id="childrenBody"></tbody>
        </table>
      </div>
    </div>
  </main>

  <footer>© 2025 Assalam. Semua hak dilindungi.</footer>

  <script>
    const ADMIN_PASSWORD = "admin123";
    const CHECK_AMOUNT = 3000;

    const sampleChildren = [
      { id: 1, name: "Ahmad", status: {} },
      { id: 2, name: "Budi", status: {} },
      { id: 3, name: "Candra", status: {} }
    ];

    let children = load("kas_children", sampleChildren);
    let settings = load("kas_settings", { admin: false });

    function load(key, fallback) {
      try {
        const v = localStorage.getItem(key);
        return v ? JSON.parse(v) : fallback;
      } catch {
        return fallback;
      }
    }

    function save(key, val) {
      localStorage.setItem(key, JSON.stringify(val));
    }

    // === Generate 12 bulan mulai Oktober ===
    function generateMonths() {
      const monthNames = ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
      const now = new Date();
      const startYear = now.getMonth() >= 9 ? now.getFullYear() : now.getFullYear() - 1;
      const arr = [];
      for (let i = 0; i < 12; i++) {
        const idx = (9 + i) % 12;
        const year = startYear + Math.floor((9 + i) / 12);
        arr.push(monthNames[idx] + " " + year);
      }
      return arr;
    }

    const MONTHS = generateMonths();

    function renderHeader() {
      const tr = document.getElementById("monthHeader");
      tr.innerHTML = "<th>Nama</th>";
      MONTHS.forEach(m => {
        const th = document.createElement("th");
        th.textContent = m;
        tr.appendChild(th);
      });
      const thTotal = document.createElement("th");
      thTotal.textContent = "Total (Rp)";
      tr.appendChild(thTotal);
    }

    function renderTable() {
      const body = document.getElementById("childrenBody");
      body.innerHTML = "";
      children.forEach(c => {
        let total = 0;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td style="text-align:left">${escapeHtml(c.name)}</td>`;

        MONTHS.forEach(m => {
          const td = document.createElement("td");
          td.style.textAlign = "center";
          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.checked = !!c.status[m];
          cb.disabled = !settings.admin;
          cb.addEventListener("change", () => {
            c.status[m] = cb.checked;
            save("kas_children", children);
            renderTable();
          });
          td.appendChild(cb);
          tr.appendChild(td);
          if (c.status[m]) total += CHECK_AMOUNT;
        });

        const tdTotal = document.createElement("td");
        tdTotal.textContent = total.toLocaleString("id-ID");
        tdTotal.className = "right";
        tr.appendChild(tdTotal);

        body.appendChild(tr);
      });
    }

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, c => (
        { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[c]
      ));
    }

    document.getElementById("adminBtn").addEventListener("click", () => {
      const pass = prompt("Masukkan sandi admin:");
      if (pass === ADMIN_PASSWORD) {
        settings.admin = true;
        save("kas_settings", settings);
        applyAdminMode();
        alert("Berhasil masuk sebagai admin");
      } else alert("Sandi salah");
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      settings.admin = false;
      save("kas_settings", settings);
      applyAdminMode();
    });

    function applyAdminMode() {
      document.getElementById("adminBtn").classList.toggle("hidden", settings.admin);
      document.getElementById("logoutBtn").classList.toggle("hidden", !settings.admin);
      renderTable();
    }

    renderHeader();
    applyAdminMode();
  </script>
</body>
</html>
