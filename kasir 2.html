<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laporan Penjualan â€” Kasir Lokal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: linear-gradient(135deg,#f6fbff 0%, #eef7ff 50%, #f3f7ff 100%);
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#4f46e5;
      --accent-2:#06b6d4;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 6px 18px rgba(16,24,40,0.08);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial; background:var(--bg1); color:#111827; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; padding:32px;
    }
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;box-shadow:var(--shadow)}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin-bottom:18px}
    form.row{display:grid;grid-template-columns:1.2fr 1fr 1fr 1fr auto;gap:12px;align-items:end}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], input[type="number"]{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e9ee;font-size:14px}
    .btn{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #e6e9ee;color:var(--muted);font-weight:600}
    .muted{color:var(--muted);font-size:13px}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    thead th{background:linear-gradient(90deg,#ffffff,#f8fbff);text-align:left;padding:12px;border-radius:8px;font-size:13px;color:#374151}
    tbody td{padding:10px;border-bottom:1px dashed #eef2ff;font-size:14px}
    .right{text-align:right}
    .center{text-align:center}
    tr.total-row td{font-weight:700;background:linear-gradient(90deg,#fbfdff,#f3f7ff)}

    .small{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:8px}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #eef2ff;background:#fff;font-size:12px}

    footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}

    @media (max-width:900px){
      form.row{grid-template-columns:1fr}
      header{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">LP</div>
      <div>
        <h1>Laporan Penjualan</h1>
        <p class="lead">Rincian produk, modal, harga jual, jumlah terjual, dan perhitungan laba otomatis (lokal).</p>
      </div>
    </header>

    <section class="card">
      <form id="productForm" class="row" onsubmit="event.preventDefault();addProduct();">
        <div>
          <label for="name">Nama Produk</label>
          <input id="name" type="text" placeholder="Contoh: Pulsa 10K" required />
        </div>
        <div>
          <label for="cost">Modal (Rp)</label>
          <input id="cost" type="number" min="0" step="1" placeholder="8000" required />
        </div>
        <div>
          <label for="price">Harga Jual (Rp)</label>
          <input id="price" type="number" min="0" step="1" placeholder="10000" required />
        </div>
        <div>
          <label for="qty">Jumlah Terjual</label>
          <input id="qty" type="number" min="0" step="1" value="1" required />
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <button class="btn" type="submit">Tambah</button>
          <button class="btn ghost" type="button" onclick="clearAll()">Hapus Semua</button>
        </div>
      </form>

      <div style="margin-top:12px;overflow:auto">
        <table id="table">
          <thead>
            <tr>
              <th>Produk</th>
              <th class="right">Modal</th>
              <th class="right">Harga Jual</th>
              <th class="center">Terjual</th>
              <th class="right">Total Modal</th>
              <th class="right">Total Penjualan</th>
              <th class="right">Laba</th>
              <th class="center">Aksi</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <!-- rows injected -->
          </tbody>
          <tfoot>
            <tr class="total-row">
              <td class="small">Total</td>
              <td></td>
              <td></td>
              <td class="right small" id="totalQty">0</td>
              <td class="right small" id="totalCost">Rp 0</td>
              <td class="right small" id="totalSales">Rp 0</td>
              <td class="right small" id="totalProfit">Rp 0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <footer>
        <div class="small muted">Data tersimpan lokal (LocalStorage). Anda bisa edit langsung di tabel.</div>
        <div style="display:flex;gap:8px">
          <button class="btn ghost" onclick="downloadCSV()">Export CSV</button>
          <button class="btn" onclick="seedExample()">Isi Contoh</button>
        </div>
      </footer>
    </section>

    <section class="card small">
      Tips: Klik dua kali pada sel produk/modal/harga/terjual untuk mengedit. Perubahan disimpan otomatis.
    </section>
  </div>

  <script>
    // data model
    let items = [];
    const KEY = 'laporan_penjualan_v1';

    // helpers
    function fmt(n){return 'Rp '+Number(n).toLocaleString('id-ID');}
    function save(){localStorage.setItem(KEY,JSON.stringify(items));}
    function load(){const s=localStorage.getItem(KEY);items = s?JSON.parse(s):[];}

    function addProduct(){
      const name = document.getElementById('name').value.trim();
      const cost = Number(document.getElementById('cost').value) || 0;
      const price = Number(document.getElementById('price').value) || 0;
      const qty = Number(document.getElementById('qty').value) || 0;
      if(!name) return alert('Masukkan nama produk');
      const item = {id:Date.now(),name,cost,price,qty};
      items.push(item); save(); render();
      document.getElementById('productForm').reset(); document.getElementById('qty').value = 1;
    }

    function render(){
      const tbody = document.getElementById('tbody'); tbody.innerHTML='';
      let totalQty=0,totalCost=0,totalSales=0,totalProfit=0;
      for(const it of items){
        const totalCostItem = it.cost * it.qty;
        const totalSalesItem = it.price * it.qty;
        const profit = (it.price - it.cost) * it.qty;
        totalQty += it.qty; totalCost += totalCostItem; totalSales += totalSalesItem; totalProfit += profit;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td contenteditable="true" data-field="name" data-id="${it.id}">${escapeHtml(it.name)}</td>
          <td contenteditable="true" class="right" data-field="cost" data-id="${it.id}">${it.cost}</td>
          <td contenteditable="true" class="right" data-field="price" data-id="${it.id}">${it.price}</td>
          <td contenteditable="true" class="center" data-field="qty" data-id="${it.id}">${it.qty}</td>
          <td class="right">${fmt(totalCostItem)}</td>
          <td class="right">${fmt(totalSalesItem)}</td>
          <td class="right">${fmt(profit)}</td>
          <td class="center">
            <div class="actions">
              <button class="pill" onclick="removeItem(${it.id})">Hapus</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
      }
      document.getElementById('totalQty').textContent = totalQty;
      document.getElementById('totalCost').textContent = fmt(totalCost);
      document.getElementById('totalSales').textContent = fmt(totalSales);
      document.getElementById('totalProfit').textContent = fmt(totalProfit);

      // attach edit handlers
      tbody.querySelectorAll('[contenteditable="true"]').forEach(cell=>{
        cell.addEventListener('blur', onCellEdit);
        cell.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); cell.blur(); } });
      });
    }

    function onCellEdit(e){
      const cell = e.currentTarget;
      const id = Number(cell.dataset.id); const field = cell.dataset.field;
      const idx = items.findIndex(x=>x.id===id); if(idx===-1) return;
      let value = cell.textContent.trim();
      if(field==='name'){ items[idx].name = value; }
      else{ // numeric fields
        // remove non-digit characters
        value = value.replace(/[^0-9\-\.]/g,'');
        const num = Number(value) || 0;
        items[idx][field] = num;
      }
      save(); render();
    }

    function removeItem(id){ items = items.filter(x=>x.id!==id); save(); render(); }
    function clearAll(){ if(confirm('Yakin hapus semua data?')){ items=[]; save(); render(); } }

    function downloadCSV(){
      if(items.length===0) return alert('Tidak ada data untuk diexport');
      const header = ['Nama Produk','Modal','Harga Jual','Jumlah Terjual','Total Modal','Total Penjualan','Laba'];
      const rows = items.map(it=>{
        const totalCost = it.cost*it.qty; const totalSales = it.price*it.qty; const profit = (it.price-it.cost)*it.qty;
        return [it.name, it.cost, it.price, it.qty, totalCost, totalSales, profit];
      });
      const csv = [header, ...rows].map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='laporan_penjualan.csv'; a.click(); URL.revokeObjectURL(url);
    }

    function seedExample(){
      items = [
        {id:1,name:'Pulsa 10K',cost:8000,price:10000,qty:20},
        {id:2,name:'Kartu Sim',cost:15000,price:20000,qty:5},
        {id:3,name:'Charger',cost:30000,price:45000,qty:3}
      ]; save(); render();
    }

    function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // init
    load(); render();

    // keyboard: quick focus to name
    document.addEventListener('keydown', e=>{
      if(e.key==='n' && (e.ctrlKey||e.metaKey)){
        e.preventDefault(); document.getElementById('name').focus();
      }
    });
  </script>
</body>
</html>

