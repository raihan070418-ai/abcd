<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Assalam.com</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0;
      background: linear-gradient(135deg, #ffffff, #e6f0ff, #cce0ff); color: #222; }
    header { display: flex; align-items: center; gap: 15px; padding: 20px;
      background: linear-gradient(135deg, #0066cc, #3399ff); color: white; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
    header img { width: 70px; height: 70px; border-radius: 50%; border: 3px solid white; object-fit: cover; }
    header .judul h1 { margin: 0; font-size: 22px; font-weight: bold; }
    header .judul p { margin: 3px 0 0; font-size: 14px; opacity: 0.9; }
    .controls { display: flex; justify-content: center; gap: 10px; margin: 15px; flex-wrap: wrap; }
    button { background: linear-gradient(135deg, #0066cc, #3399ff); border: none; padding: 10px 18px; border-radius: 8px;
      color: white; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 3px 6px rgba(0,0,0,0.15); }
    button:hover { background: linear-gradient(135deg, #0052a3, #1a8cff); transform: scale(1.05); }
    table { border-collapse: collapse; margin: 20px auto; width: 95%; background: white; border-radius: 12px; overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: linear-gradient(135deg, #0073e6, #3399ff); color: white; text-transform: uppercase; }
    td { background: #f9fcff; font-size: 14px; }
    tr:nth-child(even) td { background: #f1f7ff; }
    tr:hover td { background: #e6f2ff; transition: 0.3s; }
    .total-merah { color: #e60000; font-weight: bold; }
    .total-kuning { color: #e6a700; font-weight: bold; }
    .total-hijau { color: #009933; font-weight: bold; }
    #saldoBox { display: flex; justify-content: center; gap: 40px; margin: 20px auto; font-weight: bold; font-size: 16px;
      color: #004080; background: white; padding: 12px 20px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      width: fit-content; }
    footer { margin-top: 30px; padding: 15px 25px; font-size: 13px; color: #333; display: flex; justify-content: space-between;
      align-items: center; background: #f0f6ff; border-top: 2px solid #cce0ff; }
  </style>
</head>
<body>

<header>
  <img src="assalam.jpg" alt="Foto Profil">
  <div class="judul">
    <h1>Bendahara Assalam</h1>
    <p>Kelola Kas Putra dan Putri secara terpisah</p>
  </div>
</header>

<div class="controls">
  <button id="switchPutra">üíô Putra</button>
  <button id="switchPutri">üíñ Putri</button>
  <button id="toggleMode">Masuk Admin</button>
  <button id="gantiPassword" style="display:none;">Ganti Sandi</button>
  <button id="tambahAnak" style="display:none;">Tambah Anak</button>
  <button id="tambahSaldoLain" style="display:none;">Tambah Saldo Lain</button>
  <button id="tambahPengeluaran" style="display:none;">Tambah Pengeluaran</button>
</div>

<h2 id="judulHalaman" style="text-align:center;">üíô Data Kas Putra</h2>

<table id="kasTable">
  <thead>
    <tr>
      <th>No</th><th>Nama</th>
      <th>Okt</th><th>Nov</th><th>Des</th><th>Jan</th><th>Feb</th><th>Mar</th>
      <th>Apr</th><th>Mei</th><th>Jun</th><th>Jul</th><th>Agu</th><th>Sep</th>
      <th>Total</th><th class="aksi-col" style="display:none;">Aksi</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Pemasukan</h2>
<table id="lainTable"><thead><tr><th>No</th><th>Keterangan</th><th>Jumlah</th><th class="aksi-col" style="display:none;">Aksi</th></tr></thead><tbody></tbody></table>

<h2>Pengeluaran</h2>
<table id="pengeluaranTable"><thead><tr><th>No</th><th>Keterangan</th><th>Jumlah</th><th class="aksi-col" style="display:none;">Aksi</th></tr></thead><tbody></tbody></table>

<div id="saldoBox">
  <div>üí∞ Saldo Masuk: Rp <span id="totalSaldo">0</span></div>
  <div>üí∏ Keluar: Rp <span id="totalKeluar">0</span></div>
  <div>üè¶ Sisa: Rp <span id="saldoTerkini">0</span></div>
</div>

<footer>
  <div>Kas Assalam ¬© 2025 - Bendahara Putra & Putri</div>
</footer>

<script>
let mode = "putra"; // default halaman
let isLocked = true;
const hargaCeklis = 3000;
let filterText = "";

function getKeys(){
  return {
    data: `kasData${mode==='putra'?'Putra':'Putri'}`,
    pengeluaran: `kasPengeluaran${mode==='putra'?'Putra':'Putri'}`,
    saldo: `kasSaldoLain${mode==='putra'?'Putra':'Putri'}`,
    pass: `kasPassword${mode==='putra'?'Putra':'Putri'}`
  };
}

function loadData(){
  const k = getKeys();
  return {
    data: JSON.parse(localStorage.getItem(k.data)) || [],
    pengeluaran: JSON.parse(localStorage.getItem(k.pengeluaran)) || [],
    saldoLain: JSON.parse(localStorage.getItem(k.saldo)) || [],
    password: localStorage.getItem(k.pass) || (mode==='putra'?'1234':'4321')
  };
}

let {data, pengeluaran, saldoLain, password} = loadData();

function saveData(){
  const k = getKeys();
  localStorage.setItem(k.data, JSON.stringify(data));
  localStorage.setItem(k.pengeluaran, JSON.stringify(pengeluaran));
  localStorage.setItem(k.saldo, JSON.stringify(saldoLain));
}

function renderTable(){
  const tbody = document.querySelector("#kasTable tbody");
  tbody.innerHTML = "";
  let filteredData = data.sort((a,b)=>a.nama.localeCompare(b.nama));
  let totalSaldo = 0;

  filteredData.forEach((d,i)=>{
    let tr = `<tr><td>${i+1}</td><td>${d.nama}</td>`;
    d.bulan.forEach((v,idx)=> tr += `<td><input type="checkbox" ${v?'checked':''} ${isLocked?'onclick="return false;"':''}></td>`);
    const total = d.bulan.filter(v=>v).length;
    const totalUang = total * hargaCeklis;
    totalSaldo += totalUang;
    let warna = total===0?'total-merah':total<7?'total-kuning':'total-hijau';
    tr += `<td class="${warna}">${total} bln = Rp ${totalUang.toLocaleString()}</td>`;
    tr += isLocked ? `<td style="display:none;"></td>` : `<td><button onclick="hapusAnak(${i})">Hapus</button></td>`;
    tbody.innerHTML += tr;
  });

  if(!isLocked){
    tbody.querySelectorAll("input[type=checkbox]").forEach((cb, idx)=>{
      cb.addEventListener("change", ()=>{
        const anak = Math.floor(idx/12);
        const bulan = idx%12;
        data[anak].bulan[bulan] = cb.checked;
        saveData(); renderTable();
      });
    });
  }

  renderAll(totalSaldo);
}

function renderAll(totalSaldo){
  renderPengeluaran();
  let totalLain = renderSaldoLain();
  let totalKeluar = pengeluaran.reduce((a,b)=>a+b.jumlah,0);
  let sisa = totalSaldo + totalLain - totalKeluar;
  document.getElementById("totalSaldo").innerText = (totalSaldo+totalLain).toLocaleString();
  document.getElementById("totalKeluar").innerText = totalKeluar.toLocaleString();
  document.getElementById("saldoTerkini").innerText = sisa.toLocaleString();
}

function renderPengeluaran(){
  const tbody = document.querySelector("#pengeluaranTable tbody");
  tbody.innerHTML = "";
  pengeluaran.forEach((p,i)=>{
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${p.ket}</td><td>Rp ${p.jumlah.toLocaleString()}</td>${isLocked?'<td>-</td>':`<td><button onclick="hapusPengeluaran(${i})">Hapus</button></td>`}</tr>`;
  });
}

function renderSaldoLain(){
  const tbody = document.querySelector("#lainTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  saldoLain.forEach((s,i)=>{
    total += s.jumlah;
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${s.ket}</td><td>Rp ${s.jumlah.toLocaleString()}</td>${isLocked?'<td>-</td>':`<td><button onclick="hapusSaldoLain(${i})">Hapus</button></td>`}</tr>`;
  });
  return total;
}

function hapusAnak(i){ if(confirm("Hapus anak ini?")){ data.splice(i,1); saveData(); renderTable(); } }
function hapusPengeluaran(i){ if(confirm("Hapus pengeluaran?")){ pengeluaran.splice(i,1); saveData(); renderTable(); } }
function hapusSaldoLain(i){ if(confirm("Hapus saldo lain?")){ saldoLain.splice(i,1); saveData(); renderTable(); } }

document.getElementById("toggleMode").addEventListener("click", ()=>{
  if(isLocked){
    let pass = prompt(`Masukkan sandi Admin ${mode==='putra'?'Putra':'Putri'}:`);
    if(pass===password){
      isLocked=false;
      document.getElementById("toggleMode").innerText="Keluar Admin";
      document.querySelectorAll("#gantiPassword,#tambahAnak,#tambahSaldoLain,#tambahPengeluaran").forEach(b=>b.style.display="inline-block");
      document.querySelectorAll(".aksi-col").forEach(c=>c.style.display="table-cell");
      renderTable();
    }else alert("Sandi salah!");
  }else{
    isLocked=true;
    document.getElementById("toggleMode").innerText="Masuk Admin";
    document.querySelectorAll("#gantiPassword,#tambahAnak,#tambahSaldoLain,#tambahPengeluaran").forEach(b=>b.style.display="none");
    document.querySelectorAll(".aksi-col").forEach(c=>c.style.display="none");
    renderTable();
  }
});

document.getElementById("gantiPassword").addEventListener("click", ()=>{
  let lama = prompt("Masukkan sandi lama:");
  if(lama===password){
    let baru = prompt("Masukkan sandi baru:");
    if(baru){ password=baru; localStorage.setItem(getKeys().pass,baru); alert("Sandi diganti!"); }
  }else alert("Salah sandi lama!");
});

document.getElementById("tambahAnak").addEventListener("click", ()=>{
  let nama=prompt("Nama anak:");
  if(nama){ data.push({nama,bulan:Array(12).fill(false)}); saveData(); renderTable(); }
});

document.getElementById("tambahPengeluaran").addEventListener("click", ()=>{
  let ket=prompt("Keterangan pengeluaran:"), jumlah=parseInt(prompt("Jumlah:"));
  if(ket&&jumlah>0){ pengeluaran.push({ket,jumlah}); saveData(); renderTable(); }
});

document.getElementById("tambahSaldoLain").addEventListener("click", ()=>{
  let ket=prompt("Keterangan saldo lain:"), jumlah=parseInt(prompt("Jumlah:"));
  if(ket&&jumlah>0){ saldoLain.push({ket,jumlah}); saveData(); renderTable(); }
});

document.getElementById("switchPutra").addEventListener("click", ()=>{
  mode="putra"; ({data,pengeluaran,saldoLain,password}=loadData());
  document.getElementById("judulHalaman").innerText="üíô Data Kas Putra";
  isLocked=true; document.getElementById("toggleMode").innerText="Masuk Admin";
  document.querySelectorAll(".aksi-col").forEach(c=>c.style.display="none");
  renderTable();
});

document.getElementById("switchPutri").addEventListener("click", ()=>{
  mode="putri"; ({data,pengeluaran,saldoLain,password}=loadData());
  document.getElementById("judulHalaman").innerText="üíñ Data Kas Putri";
  isLocked=true; document.getElementById("toggleMode").innerText="Masuk Admin";
  document.querySelectorAll(".aksi-col").forEach(c=>c.style.display="none");
  renderTable();
});

renderTable();
</script>
</body>
</html>
