<DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Kas Putri ‚Äî Assalam</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');

  :root {
    --bg-1:#0d0d0d;
    --bg-2:#161616;
    --card:#1b1b1b;
    --muted:#a8a8a8;
    --accent:#00c8ff;
    --accent2:#00ffc3;
    --danger:#ff4d4d;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: 'Poppins', system-ui, Arial, sans-serif;
    background: radial-gradient(circle at top left, #0a0a0a 0%, #121212 50%, #090909 100%);
    color: #f1f1f1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 28px 18px;
  }

  header {
    text-align: center;
    margin-bottom: 18px;
  }

  header h1 {
    color: var(--accent);
    font-size: 2rem;
    text-shadow: 0 0 15px rgba(0,200,255,0.7);
  }

  header p {
    color: var(--muted);
  }

  .container {
    width: 100%;
    max-width: 1200px;
    background: rgba(255,255,255,0.02);
    border-radius: 16px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.9);
    padding: 22px;
    border: 1px solid rgba(255,255,255,0.04);
    backdrop-filter: blur(6px);
  }

  .btn {
    border: none;
    border-radius: 12px;
    padding: 10px 16px;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(135deg, #00c8ff 0%, #00ffc3 100%);
    color: #000;
    transition: all .25s ease;
  }

  .btn:hover { transform: translateY(-2px); }

  .hapus-btn {
    background: linear-gradient(135deg, #ff4d4d, #ff7373);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    font-weight: 600;
  }

  .card {
    background: var(--card);
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 14px;
  }

  .card h2 {
    color: var(--accent2);
    font-size: 1.1rem;
    text-shadow: 0 0 8px rgba(0,255,195,0.4);
  }

  .small { color: var(--muted); font-size: 0.9rem; }

  table {
    width: 100%;
    border-collapse: collapse;
    background: transparent;
  }

  th, td {
    padding: 8px 6px;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }

  thead th {
    background: linear-gradient(135deg, #00c8ff, #00ffc3);
    color: #000;
    font-weight: 700;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  /* === SCROLLABLE TABLE === */
  .scrollable {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .scrollable table {
    min-width: 800px;
    white-space: nowrap;
  }

  footer {
    margin-top: 20px;
    color: var(--muted);
    text-align: center;
    font-size: 0.85rem;
  }

  /* === Responsive untuk HP === */
  @media (max-width: 768px) {
    body { padding: 16px 10px; }
    header h1 { font-size: 1.6rem; }
    .btn { padding: 8px 12px; font-size: 0.9rem; }
    .top-actions {
      flex-direction: column;
      align-items: stretch;
      gap: 8px;
    }
    input, select { width: 100%; margin-bottom: 6px; }
    table { font-size: 0.85rem; }
  }
</style>

</head>
<body>

  <header>
    <h1>Assalam.com</h1>
    <p>Kas Putri ‚Äî Sistem pencatatan pembayaran & arus kas</p>
  </header>

  <div class="container">
    <div class="top-actions">
      <button id="loginBtn" class="btn">üîê Masuk Admin</button>
    <button id="logoutBtn" class="btn" style="display:none;">üö™ Keluar</button>
    </div>

    <!-- DATA ANAK (ceklist) -->
    <div class="card" id="cekCard">
      <h2>Daftar Santri & Pembayaran Bulanan</h2>
      <div id="addAnakForm" style="display:none; margin-bottom:10px;" class="form-inline">
  <input type="text" id="namaBaru" placeholder="Nama santri baru">
  <button id="addAnakBtn" class="btn">‚ûï Tambah Anak</button>
...
</div>

      <p class="small">Setiap ceklis bernilai Rp 3.000 (hanya admin yang dapat mengubah)</p>

     <div class="scrollable">
  <table id="cekTable">

          <thead>
            <tr>
              <th>Nama</th>
              <th>Okt</th><th>Nov</th><th>Des</th><th>Jan</th>
              <th>Feb</th><th>Mar</th><th>Apr</th><th>Mei</th>
              <th>Jun</th><th>Jul</th><th>Agu</th><th>Sep</th>
              <th>Total</th><th>Aksi</th>
            </tr>
          </thead>
          <tbody id="cekBody"></tbody>
        </table>
      </div>
    </div>

    <!-- DUAL: pemasukan & pengeluaran -->
    <div class="dual">
      <!-- PEMASUKAN -->
      <div class="card mini-table" id="inCard">
        <h2>Pemasukan</h2>
        <p class="small">Tambah pemasukan: Tanggal ‚Ä¢ Keterangan ‚Ä¢ Penanggung Jawab ‚Ä¢ Total (Rp)</p>

        <div id="inForm" style="display:none;" class="form-inline">
          <input type="date" id="inDate">
          <input type="text" id="inKeterangan" placeholder="Keterangan">
          <input type="text" id="inPJ" placeholder="Penanggung jawab">
          <input type="number" id="inJumlah" placeholder="Jumlah" min="0" step="1">
          <button id="addInBtn" class="btn">Tambah</button>
        </div>

        <div style="overflow:auto; max-height:280px;">
          <table id="inTable">
            <thead><tr><th>Tanggal</th><th>Keterangan</th><th>PJ</th><th style="text-align:right">Total (Rp)</th><th>Aksi</th></tr></thead>
            <tbody id="inBody"></tbody>
          </table>
        </div>
        <div class="totals" style="margin-top:8px;">
          <div class="box">
            <div style="font-size:0.85rem; color:var(--muted)">Total Pemasukan</div>
            <strong id="totalIn">Rp 0</strong>
          </div>
          <div style="flex:1"></div>
        </div>
      </div>

      <!-- PENGELUARAN -->
      <div class="card mini-table" id="outCard">
        <h2>Pengeluaran</h2>
        <p class="small">Tambah pengeluaran: Tanggal ‚Ä¢ Keterangan ‚Ä¢ Penanggung Jawab ‚Ä¢ Total (Rp)</p>

        <div id="outForm" style="display:none;" class="form-inline">
          <input type="date" id="outDate">
          <input type="text" id="outKeterangan" placeholder="Keterangan">
          <input type="text" id="outPJ" placeholder="Penanggung jawab">
          <input type="number" id="outJumlah" placeholder="Jumlah" min="0" step="1">
          <button id="addOutBtn" class="btn">üí∏ Tambah</button>
        </div>

        <div style="overflow:auto; max-height:280px;">
          <table id="outTable">
            <thead><tr><th>Tanggal</th><th>Keterangan</th><th>PJ</th><th style="text-align:right">Total (Rp)</th><th>Aksi</th></tr></thead>
            <tbody id="outBody"></tbody>
          </table>
        </div>
        <div class="totals" style="margin-top:8px;">
          <div class="box">
            <div style="font-size:0.85rem; color:var(--muted)">Total Pengeluaran</div>
            <strong id="totalOut">Rp 0</strong>
          </div>
          <div style="flex:1"></div>
        </div>
      </div>
    </div>

    <!-- SALDO -->
    <div style="margin-top:14px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
      <div class="card" style="flex:1;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <div>
            <div style="color:var(--muted)">Total Semua Kas</div>
            <div style="font-size:1.15rem; color:var(--accent2); font-weight:700" id="grandTotal">Rp 0</div>
          </div>
          <div style="text-align:right;">
            <div style="color:var(--muted)">Saldo Akhir</div>
            <div style="font-size:1.25rem; font-weight:800; color:var(--accent);" id="saldoAkhir">Rp 0</div>
          </div>
        </div>
      </div>

      <div class="card" style="width:240px; text-align:center;">
        <div style="color:var(--muted); font-size:0.9rem;">Admin Controls</div>
        <div style="margin-top:8px;">
          <button id="toggleForms" class="btn ghost" title="Tampilkan/ sembunyikan form tambah">üßæ Form</button>
<button id="exportBtn" class="btn" title="Ekspor data ke CSV">üì§ Ekspor CSV</button>
        </div>
      </div>
    </div>

  </div>

  <footer>¬© 2025 Assalam ‚Ä¢ Tema dark elegan</footer>

  <script>
    /* ---------- Data & Config ---------- */
    const ADMIN_PASSWORD = "admin123";
    const PER_CEK = 3000;

    // load or initialize
    let data = JSON.parse(localStorage.getItem("kasPutraData_v3")) || {
      santri: { "Ahmad": {}, "Budi": {}, "Candra": {}, "Deni": {}, "Eko": {} },
      pemasukan: [],
      pengeluaran: []
    };

    let isAdmin = false;

    /* ---------- Helpers ---------- */
    const $ = id => document.getElementById(id);
    const fmtRupiah = n => {
      // ensure integer
      n = Number(n) || 0;
      return "Rp " + n.toLocaleString('id-ID');
    };

    function saveAll(){ localStorage.setItem("kasPutraData_v3", JSON.stringify(data)); }

    /* ---------- Render ceklist santri ---------- */
    function renderSantri(){
      const tbody = $('cekBody');
      tbody.innerHTML = "";
      let totalKas = 0;

      Object.keys(data.santri).forEach(nama=>{
        const tr = document.createElement('tr');
        const nameTd = document.createElement('td');
        nameTd.textContent = nama;
        tr.appendChild(nameTd);

        let personTotal = 0;
        const months = ["Okt","Nov","Des","Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep"];
        months.forEach(m=>{
          const td = document.createElement('td');
          const chk = document.createElement('input');
          chk.type = 'checkbox';
          chk.checked = !!data.santri[nama][m];
          chk.disabled = !isAdmin;
         chk.addEventListener('change', ()=>{
  data.santri[nama][m] = chk.checked;
  saveAll();

  // === Tambahan otomatis masuk ke pemasukan ===
  if (chk.checked) {
    const tanggal = new Date().toISOString().slice(0,10);
    data.pemasukan.push({
      tanggal: tanggal,
      keterangan: `Iuran bulanan ${nama} (${m})`,
      pj: nama,
      jumlah: PER_CEK
    });
    saveAll();
  } else {
    // kalau checkbox dibatalkan, hapus pemasukan terkait
    data.pemasukan = data.pemasukan.filter(r =>
      !(r.keterangan === `Iuran bulanan ${nama} (${m})` && r.jumlah === PER_CEK)
    );
    saveAll();
  }

  renderSantri();
  renderInOut();
  renderTotals();
});

          td.appendChild(chk);
          tr.appendChild(td);
          if (chk.checked) personTotal += PER_CEK;
        });

        const totalTd = document.createElement('td');
        totalTd.textContent = fmtRupiah(personTotal);
        tr.appendChild(totalTd);

        const aksiTd = document.createElement('td');
        if (isAdmin){
          const del = document.createElement('button');
          del.className='hapus-btn';
          del.textContent='Hapus';
          del.addEventListener('click', ()=>{
            if (confirm('Hapus '+nama+' dari daftar?')) {
              delete data.santri[nama];
              saveAll(); renderSantri(); renderTotals();
            }
          });
          aksiTd.appendChild(del);
        } else {
          aksiTd.textContent = '-';
        }
        tr.appendChild(aksiTd);

        tbody.appendChild(tr);
        totalKas += personTotal;
      });
      // we don't display totalKas here because monetary totals are from pemasukan/pengeluaran.
    }

    /* ---------- Render pemasukan/pengeluaran ---------- */
    function renderInOut(){
      // pemasukan
      const inBody = $('inBody'); inBody.innerHTML='';
      let totalIn = 0;
      data.pemasukan.slice().reverse().forEach((row, idxRev)=>{
        const idx = data.pemasukan.length - 1 - idxRev;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${row.tanggal}</td>
                        <td>${escapeHtml(row.keterangan)}</td>
                        <td>${escapeHtml(row.pj)}</td>
                        <td style="text-align:right">${Number(row.jumlah).toLocaleString('id-ID')}</td>
                        <td style="text-align:center"></td>`;
        const aksiTd = tr.querySelector('td:last-child');
        if (isAdmin){
          const b = document.createElement('button');
          b.className='hapus-btn';
          b.textContent='Hapus';
          b.addEventListener('click', ()=>{
            if (confirm('Hapus pemasukan ini?')){
              data.pemasukan.splice(idx,1);
              saveAll(); renderInOut(); renderTotals();
            }
          });
          aksiTd.appendChild(b);
        } else aksiTd.textContent='-';
        inBody.appendChild(tr);
        totalIn += Number(row.jumlah) || 0;
      });

      $('totalIn').textContent = fmtRupiah(totalIn);

      // pengeluaran
      const outBody = $('outBody'); outBody.innerHTML='';
      let totalOut = 0;
      data.pengeluaran.slice().reverse().forEach((row, idxRev)=>{
        const idx = data.pengeluaran.length - 1 - idxRev;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${row.tanggal}</td>
                        <td>${escapeHtml(row.keterangan)}</td>
                        <td>${escapeHtml(row.pj)}</td>
                        <td style="text-align:right">${Number(row.jumlah).toLocaleString('id-ID')}</td>
                        <td style="text-align:center"></td>`;
        const aksiTd = tr.querySelector('td:last-child');
        if (isAdmin){
          const b = document.createElement('button');
          b.className='hapus-btn';
          b.textContent='Hapus';
          b.addEventListener('click', ()=>{
            if (confirm('Hapus pengeluaran ini?')){
              data.pengeluaran.splice(idx,1);
              saveAll(); renderInOut(); renderTotals();
            }
          });
          aksiTd.appendChild(b);
        } else aksiTd.textContent='-';
        outBody.appendChild(tr);
        totalOut += Number(row.jumlah) || 0;
      });

      $('totalOut').textContent = fmtRupiah(totalOut);
    }

    /* ---------- Totals & Saldo ---------- */
    function renderTotals(){
      // totals from pemasukan/pengeluaran
      const totalIn = data.pemasukan.reduce((s,r)=> s + (Number(r.jumlah)||0), 0);
      const totalOut = data.pengeluaran.reduce((s,r)=> s + (Number(r.jumlah)||0), 0);
      const grand = totalIn - totalOut; // saldo
      $('grandTotal').textContent = fmtRupiah(totalIn);
      $('saldoAkhir').textContent = fmtRupiah(grand);
    }

    /* ---------- Add handlers ---------- */
    $('addInBtn').addEventListener('click', ()=>{
      if (!isAdmin) return alert('Hanya admin yang dapat menambah data.');
      const t = $('inDate').value;
      const ket = $('inKeterangan').value.trim();
      const pj = $('inPJ').value.trim();
      const num = Number($('inJumlah').value);
      if (!t || !ket || !pj || !num || num<=0) return alert('Isi semua field pemasukan dengan benar.');
      data.pemasukan.push({ tanggal: t, keterangan: ket, pj: pj, jumlah: Math.round(num) });
      saveAll(); $('inDate').value=''; $('inKeterangan').value=''; $('inPJ').value=''; $('inJumlah').value='';
      renderInOut(); renderTotals();
    });

    $('addOutBtn').addEventListener('click', ()=>{
      if (!isAdmin) return alert('Hanya admin yang dapat menambah data.');
      const t = $('outDate').value;
      const ket = $('outKeterangan').value.trim();
      const pj = $('outPJ').value.trim();
      const num = Number($('outJumlah').value);
      if (!t || !ket || !pj || !num || num<=0) return alert('Isi semua field pengeluaran dengan benar.');
      data.pengeluaran.push({ tanggal: t, keterangan: ket, pj: pj, jumlah: Math.round(num) });
      saveAll(); $('outDate').value=''; $('outKeterangan').value=''; $('outPJ').value=''; $('outJumlah').value='';
      renderInOut(); renderTotals();
    });
$('addAnakBtn').addEventListener('click', ()=>{
  if (!isAdmin) return alert('Hanya admin yang dapat menambah anak.');
  const nama = $('namaBaru').value.trim();
  if (!nama) return alert('Nama tidak boleh kosong.');
  if (data.santri[nama]) return alert('Nama sudah ada di daftar.');
  data.santri[nama] = {};
  saveAll();
  $('namaBaru').value = '';
  renderSantri();
  alert('Santri baru berhasil ditambahkan!');
});

    /* ---------- Admin login ---------- */
   $('loginBtn').addEventListener('click', ()=>{
  const pass = prompt('Masukkan sandi admin:');
  if (pass === ADMIN_PASSWORD){
    isAdmin = true;
    $('loginBtn').style.display='none';
    $('logoutBtn').style.display='inline-block';
    document.querySelectorAll('#inForm, #outForm, #addAnakForm').forEach(e=> e.style.display='flex');
    renderSantri(); renderInOut();
    alert('Mode admin aktif.');
  } else alert('Sandi salah.');
});
$('logoutBtn').addEventListener('click', ()=>{
  isAdmin = false;
  $('loginBtn').style.display='inline-block';
  $('logoutBtn').style.display='none';
  document.querySelectorAll('#inForm, #outForm, #addAnakForm').forEach(e=> e.style.display='none');
  renderSantri(); renderInOut();
});



    /* toggle forms */
    $('toggleForms').addEventListener('click', ()=>{
      const visible = document.querySelector('#inForm').style.display !== 'none';
      document.querySelectorAll('#inForm, #outForm').forEach(e=> e.style.display = visible ? 'none' : 'flex');
    });

    /* ---------- Export CSV (simple) ---------- */
    function arrayToCSV(rows){
      return rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
    }

    $('exportBtn').addEventListener('click', ()=>{
      const rows = [];
      rows.push(['--- Pemasukan ---']);
      rows.push(['Tanggal','Keterangan','Penanggung Jawab','Jumlah']);
      data.pemasukan.forEach(r => rows.push([r.tanggal, r.keterangan, r.pj, r.jumlah]));
      rows.push([]);
      rows.push(['--- Pengeluaran ---']);
      rows.push(['Tanggal','Keterangan','Penanggung Jawab','Jumlah']);
      data.pengeluaran.forEach(r => rows.push([r.tanggal, r.keterangan, r.pj, r.jumlah]));
      const csv = arrayToCSV(rows);
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'kas-putra-export.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    /* ---------- Utils ---------- */
    function escapeHtml(t){ return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    /* ---------- Initial render ---------- */
    (function init(){
      // hide forms by default (unless admin)
      document.querySelectorAll('#inForm, #outForm').forEach(e=> e.style.display='none');
      renderSantri(); renderInOut(); renderTotals();
    })();

  </script>
</body>
</html>
